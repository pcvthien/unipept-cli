#!/usr/bin/env ruby
require 'typhoeus'
require 'cri'

Signal.trap("PIPE", "EXIT")
Signal.trap("INT", "EXIT")

def get_uniprot_entry(arg, fasta = false)
  resp = Typhoeus.get("http://www.uniprot.org/uniprot/#{arg}.fasta")
  if resp.success?
    if fasta
      puts resp.response_body
    else
      puts resp.response_body.lines.map(&:chomp)[1..-1].join("")
    end
  end
end

fasta = ARGV.delete "--fasta"

if ARGV.empty?
  STDIN.each_line do |pept|
    get_uniprot_entry(pept.chomp, fasta)
  end
else
  ARGV.each do |pept|
    get_uniprot_entry(pept, fasta)
  end
end
