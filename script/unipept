#!/usr/bin/env ruby

require 'cri'
require 'faraday'

root_cmd = Cri::Command.new_basic_root.modify do
  name 'unipept'
end

root_cmd.define_command('single') do
  usage       'single [options]'
  aliases     :s
  summary     'Single Peptide Search'
  description 'Search Unipept for the given peptide and return taxons'

  flag :e, :equate, "equate I and L"

  run do |opts, args, cmd|
    peptide = STDIN.read.chomp
    # TODO: make this configurable
    puts Faraday.get("http://localhost:3000/api/v1/single.json", sequence: peptide, equate_il: opts[:equate]).body
  end
end

root_cmd.run(ARGV)
