<%=
  @result.map do |k,p|
    lineage_info = Hash[Lineage::ORDER.zip(p.lineage.to_a)]
    lineage_info.reject! { |k,v| v.blank? } unless @full_lineage
    res = { sequence: k,
      taxon_id: p.id,
      taxon_name: p.name,
      taxon_parent_id: p.parent_id,
      taxon_rank: p.rank,
    }
    if @full_lineage
      res.merge(lineage_info)
    else
      res
    end
  end.to_json.html_safe
%>
