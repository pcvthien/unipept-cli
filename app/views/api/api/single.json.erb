<%=
  Oj.dump(
    @input_order.map do |k|
      seq_index = @equate_il ? k.gsub(/I/,'L') : k
      v = @result[seq_index]
      v.map do |p|
        if @full_lineage
          lineage = p.lineage
          ids = Lineage::ORDER.map {|o| lineage.try(o) }
          id_names = Lineage::ORDER.map {|s| s == :class_ ? "class_id" : "#{s}_id"}

          if @names
            names = Lineage::ORDER.map {|s| s == :class_ ? "class_name" : "#{s}_name"}
            a = names.zip(lineage.to_a)
            b = id_names.zip(ids)
            lineage_info = Hash[a.zip(b).flatten(1)]
          else
            lineage_info = Hash[id_names.zip(ids)]
          end
        end
        res = { "sequence" => k,
                "taxon_id" => p.id,
                "taxon_name" => p.name,
                "taxon_parent_id" => p.parent_id,
                "taxon_rank" => p.rank,
        }
        if @full_lineage
          res.merge!(lineage_info)
        else
          res
        end
      end
    end.flatten).html_safe
%>
